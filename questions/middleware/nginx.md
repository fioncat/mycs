# Nginx

## 我们为什么要使用Nginx做反向代理？

- 如果应用服务器有很多个，可以利用Nginx做负载均衡，并且在进行弹性扩容，或迁移服务器，只需要修改Nginx配置，对用户完全透明。
- 可以卸载某些协议，例如HTTPS，让应用服务器跟Nginx做更高效的通信。
- 将应用服务器的真实地址屏蔽，用户无法直接攻击应用服务器。
- 可以对流量进行限流、鉴权等操作，减小应用服务器的压力。

## 有哪些限流算法，它们的优缺点？

- 漏桶：突发流量会进入一个漏桶，并按照我们设置的速率来依次处理请求。如果流量过大会发生溢出。漏桶算法的频率是限定的，不会产生突发，但是处理效率会比较低。如果请求较少而且服务器承载能力较差，可以考虑使用。
- 令牌桶：根据时间匀速产生令牌，每个请求需要获取令牌才能处理。令牌桶限制的主要是平均流量，允许一定的突发流量，这可以让流量可以被快速处理。如果请求较大，并且服务器的QPS比较高，可以使用。

## Nginx的动静分离是什么？为什么需要？

静态资源是一些不会变的资源，例如图片，js，css等，这些资源可以被事先缓存起来，以加快它们的读取速度。

因此Nginx可以支持动静分离，即对于动态流量，不做缓存，直接走应用服务器；对于静态资源，可以走缓存。方法是使用不同的location进行匹配。

## Nginx的负载均衡算法？

如果有多个上游服务器，可以选择不同的负载均衡算法进行匹配：

- roundrobin：依次轮询每个上游。
- weight：赋一个权值，权值越高的上游匹配几率越高。
- ip_hash：每个请求按照IP进行绑定，使来自同一个IP的所有请求都走同一个上游。
- fair：需要插件的支持，根据页面大小和加载时间动态选择上游。